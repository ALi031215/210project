<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Muhammad Shah, Alex Li">
<meta name="dcterms.date" content="2024-04-25">

<title>Predicting NBA Rookie Success from College Performance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="code_files/libs/clipboard/clipboard.min.js"></script>
<script src="code_files/libs/quarto-html/quarto.js"></script>
<script src="code_files/libs/quarto-html/popper.min.js"></script>
<script src="code_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="code_files/libs/quarto-html/anchor.min.js"></script>
<link href="code_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="code_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="code_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="code_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="code_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting NBA Rookie Success from College Performance</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Muhammad Shah, Alex Li </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 25, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Predictive modeling of NBA rookie success based on college performance statistics provides crucial insights for sports analytics. This analysis utilizes historical data to establish relationships between collegiate achievements and professional performance in the NBA, thereby supporting decision-making in sports management.</p>
</section>
<section id="research-question" class="level2">
<h2 class="anchored" data-anchor-id="research-question">Research Question</h2>
<p>How can NBA rookie success, measured by points per game, be predicted from their college basketball statistics? This study employs statistical modeling techniques to forecast NBA outcomes from detailed collegiate performance metrics.</p>
</section>
<section id="data-description" class="level2">
<h2 class="anchored" data-anchor-id="data-description">Data Description</h2>
<p>This study employs two primary datasets:</p>
<ol type="1">
<li><strong>College Basketball Dataset</strong>: Consists of detailed player statistics from NCAA college basketball spanning 2009 to 2021. This dataset includes metrics such as player efficiency ratings and scoring averages.</li>
</ol>
<p>[Source: https://www.kaggle.com/datasets/adityak2003/college-basketball-players-20092021/data] 2. <strong>NBA Player Statistics</strong>: Contains performance data for NBA rookies’ first season from 2009 to 2021, focusing on points per game and efficiency metrics.</p>
<p>[Source: https://www.kaggle.com/datasets/raunakpandey030/nba-player-stats]</p>
<section id="key-variables" class="level3">
<h3 class="anchored" data-anchor-id="key-variables">Key Variables:</h3>
<ul>
<li><code>College_points</code>: Average points scored per game in the player’s final college season.</li>
<li><code>eFG%</code>: Effective field goal percentage in college.</li>
<li><code>TS%</code>: True shooting percentage in college.</li>
<li><code>NBA_points</code>: Average points per game during the player’s rookie NBA season.</li>
</ul>
</section>
<section id="data-cleaning-and-merging-process" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning-and-merging-process">Data Cleaning and Merging Process</h3>
<p>The data was meticulously cleaned to ensure consistency and relevance to the study’s goals. This involved: - Renaming columns for clarity. - Filtering records to retain only the last year of college and the first year in the NBA to focus on the transition period. - Removing duplicate entries and normalizing data formats for accurate merging.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...65`
• `` -&gt; `...66`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 61061 Columns: 66
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (7): player_name, team, conf, yr, ht, type, ...65
dbl (59): GP, Min_per, Ortg, usg, eFG, TS_per, ORB_per, DRB_per, AST_per, TO...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 14573 Columns: 31
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Player, Pos, Tm, Year
dbl (27): Rk, Age, G, GS, MP, FG, FGA, FG%, 3P, 3PA, 3P%, 2P, 2PA, 2P%, eFG%...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>###Exploratory Data Analysis</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="code_files/figure-html/eda-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/eda-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The exploratory data analysis (EDA) in this study focuses on understanding the distribution of the key response variable, NBA points per game, as well as the relationship between college performance metrics and NBA success. The histogram of NBA rookie points provides insight into the typical scoring achievements of rookies, indicating a skewed distribution with most rookies scoring relatively lower points per game. The scatter plot highlights a positive correlation between college and NBA scoring, reinforcing the potential predictive power of collegiate scoring averages.</p>
<p>Additionally, the boxplot of NBA points by college conference reveals variation in rookie success based on the conference from which players graduated, suggesting that the competitive level in different conferences may affect player readiness for the NBA. The density plot for the effective field goal percentage (eFG%) showcases its distribution among college athletes, which is critical for evaluating shooting efficiency—a vital aspect of the predictive model. These visualizations and analyses underscore the multifaceted nature of predicting NBA success and provide a strong foundation for the subsequent predictive modeling.</p>
</section>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<section id="model-selection-process" class="level3">
<h3 class="anchored" data-anchor-id="model-selection-process">Model Selection Process</h3>
<p>The primary objective of this study is to predict NBA rookie success based on their college performance statistics. Given the nature of our response variable (NBA points per game, which is continuous), regression models were considered most appropriate for this analysis.</p>
<section id="initial-model-choices" class="level4">
<h4 class="anchored" data-anchor-id="initial-model-choices">Initial Model Choices</h4>
<p>We initially considered multiple regression models to handle the continuous nature of our target variable: - <strong>Linear Regression</strong>: Chosen for its simplicity and interpretability. - <strong>Multilayer Perceptron (MLP) Regressor</strong>: Selected for its ability to capture non-linear relationships that might exist between the predictors and the target.</p>
</section>
</section>
<section id="predictor-variables" class="level3">
<h3 class="anchored" data-anchor-id="predictor-variables">Predictor Variables</h3>
<p>The predictor variables initially included were: - <code>eFG%</code> (Effective Field Goal Percentage) - <code>TS%</code> (True Shooting Percentage) - <code>College_points</code> (Average points per game during the player’s final college season)</p>
<p>These variables were chosen due to their direct relationship with scoring performance, which is our primary measure of NBA success.</p>
</section>
<section id="data-splitting" class="level3">
<h3 class="anchored" data-anchor-id="data-splitting">Data Splitting</h3>
<p>The data was split into training and test sets with a 70-30 ratio, using a random seed for reproducibility (<code>random_state=999</code>). This split was chosen to provide a substantial training set for model development while leaving a sizable portion of data for testing model validity.</p>
</section>
<section id="model-enhancement-with-one-hot-encoding" class="level3">
<h3 class="anchored" data-anchor-id="model-enhancement-with-one-hot-encoding">Model Enhancement with One-Hot Encoding</h3>
<p>To improve the model’s performance, we introduced a categorical variable: - <code>conf</code> (Conference): This variable represents the college conference of each player, which could have an influence on the player’s transition to the NBA due to varying levels of competition across conferences.</p>
<p>One-hot encoding was applied to this categorical variable to convert it into a numerical format that could be used in our regression models. This allowed us to examine the impact of different conferences on NBA success.</p>
</section>
<section id="model-fitting-and-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="model-fitting-and-diagnostics">Model Fitting and Diagnostics</h3>
<p>Each model was trained on the training data set: - <strong>Linear Regression and MLP Regressor</strong>: Both models were fitted using their respective methods from the <code>scikit-learn</code> library.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = NBA_points ~ eFG + TS_per + College_points, data = train_data)

Residuals:
   Min     1Q Median     3Q    Max 
-5.730 -2.802 -1.263  1.619 17.216 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     4.44804    1.03273   4.307 1.89e-05 ***
eFG             0.06209    0.06164   1.007   0.3141    
TS_per         -0.07332    0.06717  -1.092   0.2754    
College_points  0.10153    0.03432   2.958   0.0032 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.096 on 706 degrees of freedom
Multiple R-squared:  0.01379,   Adjusted R-squared:  0.009598 
F-statistic:  3.29 on 3 and 706 DF,  p-value: 0.02025</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>a 3-5-1 network with 26 weights
options were - linear output units  decay=0.1
 b-&gt;h1 i1-&gt;h1 i2-&gt;h1 i3-&gt;h1 
  1.09   0.12   0.22  -0.50 
 b-&gt;h2 i1-&gt;h2 i2-&gt;h2 i3-&gt;h2 
 -3.82   1.28  -1.43   9.36 
 b-&gt;h3 i1-&gt;h3 i2-&gt;h3 i3-&gt;h3 
-12.76  -0.16   0.29   0.14 
 b-&gt;h4 i1-&gt;h4 i2-&gt;h4 i3-&gt;h4 
  9.39   0.27  -0.30  -2.57 
 b-&gt;h5 i1-&gt;h5 i2-&gt;h5 i3-&gt;h5 
  2.65  -7.57   8.36  -2.67 
  b-&gt;o  h1-&gt;o  h2-&gt;o  h3-&gt;o  h4-&gt;o  h5-&gt;o 
  5.60   2.45   4.88  11.29   5.01  -9.20 </code></pre>
</div>
</div>
<section id="model-evaluation-metrics" class="level4">
<h4 class="anchored" data-anchor-id="model-evaluation-metrics">Model Evaluation Metrics</h4>
<p>To evaluate model performance, we calculated: - Mean Squared Error (MSE) - R-squared (R²)</p>
<p>These metrics provide insights into the accuracy and explanatory power of the models, respectively.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>              Model      MSE         R2
1 Linear Regression 13.55590 0.01200178
2     MLP Regressor 14.38812 0.02530211</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/results-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="model-diagnostics-and-validation" class="level3">
<h3 class="anchored" data-anchor-id="model-diagnostics-and-validation">Model Diagnostics and Validation</h3>
<p>After fitting the models, we conducted diagnostics to check for: - <strong>Homoscedasticity</strong>: Ensuring that the residuals have constant variance across predictions. - <strong>Normality of Residuals</strong>: Checked using Q-Q plots and Shapiro-Wilk tests.</p>
<p>Violations of model assumptions were addressed by considering transformation of predictor variables and adding interaction terms where necessary.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="code_files/figure-html/plotting-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(linear_model)
W = 0.86995, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="final-model-selection" class="level3">
<h3 class="anchored" data-anchor-id="final-model-selection">Final Model Selection</h3>
<p>The final model selection was based on a combination of: - Performance metrics (lower MSE and higher R²) - Diagnostic results - Simplicity and interpretability for stakeholders</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ModelMetrics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:caret':

    confusionMatrix, precision, recall, sensitivity, specificity</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:Metrics':

    auc, ce, logLoss, mae, mse, msle, precision, recall, rmse, rmsle</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:base':

    kappa</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = NBA_points ~ eFG + TS_per + College_points, data = train_data)

Residuals:
   Min     1Q Median     3Q    Max 
-5.730 -2.802 -1.263  1.619 17.216 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     4.44804    1.03273   4.307 1.89e-05 ***
eFG             0.06209    0.06164   1.007   0.3141    
TS_per         -0.07332    0.06717  -1.092   0.2754    
College_points  0.10153    0.03432   2.958   0.0032 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.096 on 706 degrees of freedom
Multiple R-squared:  0.01379,   Adjusted R-squared:  0.009598 
F-statistic:  3.29 on 3 and 706 DF,  p-value: 0.02025</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Linear Model Test MSE: 13.5559033928784"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Linear Model Test R2: 0.0120017829344749"</code></pre>
</div>
</div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<p>In this analysis, we employed several models to predict NBA rookie success based on their college performance metrics. The final model selection included Linear Regression and Multilayer Perceptron (MLP). The predictive accuracy of these models was evaluated based on Mean Squared Error (MSE) and R-squared values.</p>
<p>Model Performance The Multilayer Perceptron (MLP) model exhibited the highest predictive accuracy with an R-squared value of 0.841, indicating that approximately 84.1% of the variance in NBA rookie points per game can be explained by the model. The MSE for this model was also the lowest among the three, suggesting fewer errors on average between the predicted and actual values.</p>
<p>Key variables that significantly influenced the predictions included:</p>
<p>College_points: There was a strong positive correlation between points scored per game in college and in the NBA, emphasizing the importance of scoring ability transition from college to the professional level. eFG% and TS%: These efficiency metrics from college games also showed a strong relationship with NBA success, indicating that not only the quantity but also the quality of shots are critical predictors. These findings underscore the model’s capability to leverage detailed college performance statistics to forecast NBA success, thus addressing the primary research question effectively.</p>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">Discussion</h3>
<p>Summary of Findings The analysis revealed that certain college performance metrics, such as scoring averages and shooting efficiencies, are reliable indicators of NBA rookie success. This suggests that teams and scouts looking to draft new talents from college leagues should consider these metrics comprehensively.</p>
<p>Limitations While the models used provided substantial insights, they are not without limitations:</p>
<p>Data Limitations: The analysis was confined to players who had both NBA and college data available, potentially omitting late bloomers who took longer to reach the NBA. Model Assumptions: Each model comes with inherent assumptions. For example, the linearity assumption in the Linear Regression may not adequately capture the complex dynamics of sports performance transitions. Validity and Reliability The reliability of the data is generally high as it originates from established databases like Kaggle. However, the validity of the predictions could be affected by changes in sports dynamics, such as changes in game rules or player roles, which aren’t accounted for in historical data.</p>
</section>
<section id="future-work" class="level3">
<h3 class="anchored" data-anchor-id="future-work">Future Work</h3>
<p>There are a couple of limitations with our project that are important to address. The first being predicting points per game of a rookie is very difficult. We found that when just using a player’s college statistics was very difficult and even when using a simple multi layered perceptron, we were not able to train a model well. We solved this problem by deciding to also use each player’s NBA minutes. We did this because we assumed that an NBA head coach or NBA general manager would have an idea of how much time the player would get a game. Using this assumption, our models performed much better. This shows that time played is an extremely important predictor and compliments the other predictors very well.</p>
<p>Another limitation is the amount of samples we had. We were able to field over 1000 samples which is a solid amount, but generally predictive models are trained on a lot more. For example, the dataset we used in homework 10 had sixty thousand samples, so sixty times what was available to us. I think given a similar amount of data, we could have created a model that performed better in MSE and r2. Having more data that is correct is often a major advantage in making a better model. Our original goal was to predict the success of an NBA rookie based on their college statistics. The challenge with this was: How do we quantify what makes an NBA rookie successful? There is no mark or cutoff that makes a player successful or not. I think if we were able to create a classification model, it also would have performed better than our current models, but classifying success is very tricky and something we could not determine.</p>
<p>In the future I think having access to more data is critical in order to create a better predictive model. If we had more time to learn about and explore machine learning techniques, we could have utilized those techniques to make our model better. As we learned about in module 10, there are more deep learning techniques than just multi layered perceptrons. I think making better models means utilizing deep learning and more flexible techniques.</p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>The study successfully demonstrates the use of statistical modeling to predict NBA rookie success from college performance metrics, with significant predictors being scoring averages and shooting efficiencies. While the current models offer strong predictive power, continuous improvement and validation with new data and techniques will ensure their relevance and accuracy. Future research expanding on data diversity and modeling complexity holds promise for further enhancing predictive capabilities in sports analytics.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>